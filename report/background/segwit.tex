\Section{Segregated Witness}\label{segwit}
Segregated witness (sometimes called just segwit) is a relatively recent addition to bitcoin. A witness in cryptography is a proof of knowledge, for example a signature that acts as proof that whoever created the signature knows the private key that created a certain public key. A signature can also act as proof that the signer knew the content of whatever data that was signed.\cite{antonopoulos_2017}\cite{ecc_def}

\textbf{In bitcoin the script in each input is the witness}, and segregated witness means that the witness part of the transaction is separated from the transaction. The witness is still sent with the transaction when broadcasting, but it is no longer part of the transaction structure.\cite{antonopoulos_2017}\cite{segwitbip}

The reason for this change has to do with malleability. If a transaction still has the witness data it can be manipulated in millions of ways, and all these manipulated versions will all be valid. Let's look at an example, If a transaction has the following input script:

\texttt{<signature> <public key>}

A malicious actor could manipulate the script like this for example:

\texttt{1 OP\_DROP <signature> <public key>}

The script is still valid.\footnote{A transaction with that input script would be rejected in current implementation, but it shows the concept of malleability pretty well} Witness manipulation is not a security flaw in terms of monetary loss as the outputs can't be manipulated without breaking the signatures. What is changed however is the txid. The txid is used to identify the transaction, it is the hash of the entire transaction, you could imagine Alice sending money to Bob, Bob manipulates the transaction so that the txid changes, one of the manipulated transactions makes it into a block thus making all other versions, including the original, invalid, Bob got his money but he can now tell Alice that he didn't. Alice tries to find her transaction in the blockchain with the txid she had but it can't be found.

Segregated witness was Eric Lombrozo et al. in December 2015 and activated via a soft fork on \texttt{21st July 2017}\cite{antonopoulos_2017}\cite{segwitbip}, it's purpose is to make the Bitcoin network ready for lightning network usage.\cite{segwitbip} Segregated witness is not a necessity for payment channels and lightning network. But it does make it significantly safer.\cite{segwitbip} A great example is the funding of payment channels. The funding transaction requires the signature of both parties to be spent, to prevent a malicious actor from broadcasting the funding transaction and locking both participants money eternally both signs the initial commitment transaction. The commitment transaction of course use the id of txid of the funding transaction as reference. With malleable transactions a malicious actor could modify the funding transaction and broadcast it. The commitment transaction would be useless as it's referenced txid doesn't exist.

As mentioned segwit separates the witness and transaction. This makes it so the witness is no longer part of the txid, making it effectively immutable. The witness data is stored separately to the blockchain and it's byte-size is not counted towards the block size, making it so more transactions could fit in a single block; it does not make the storage requirement any smaller as the witness data still needs to be stored for validation. 